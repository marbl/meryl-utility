# -*- makefile -*-

LIBBRI/     :=$(call MakePath,$/../libbri/)
FASTA/      :=$(call MakePath,$/../fasta/)
MERYL/      :=$(call MakePath,$/../meryl/)
EXISTDB/    :=$(call MakePath,$/../existDB/)
UTIL/       :=$(call MakePath,$/../util/)

src           :=$/positionDB.C $/positionDB.H $/positionDB-access.C $/positionDB-dump.C $/positionDB-sort.C $/positionDB-file.C 
$/.CXX_SRCS   := $/driver.C $(filter %.C,${src})
$/.CXX_EXES   := $/positionDB
$/.CXX_LIBS   := $/libpositionDB.a
$/.CLEAN      := $/*.o
$/.REAL-CLEAN := $/buildinfo-*

$/libpositionDB.a:   $/buildinfo-positionDB.o $/positionDB.o $/positionDB-access.o $/positionDB-dump.o $/positionDB-sort.o $/positionDB-file.o
$/positionDB:        $/driver.o ${MERYL/}libmeryl.a ${EXISTDB/}libexistDB.a $/libpositionDB.a

$(eval $/%.d $/%.o:    CXXFLAGS+= -I${EXISTDB/} -I${FASTA/} -I${MERYL/} -I${LIBBRI/})

${$/.CXX_EXES}: ${EXISTDB/}libexistDB.a ${MERYL/}libmeryl.a ${LIBBRI/}libbri.a $/libpositionDB.a

$/buildinfo-positionDB.c: $/buildinfo-positionDB.h
$/buildinfo-positionDB.h: ${src}
	@${UTIL/}buildinfo.pl positionDB "${CXXFLAGS} ${CXXFLAGS_COMPILE}" $^
	@[ `dirname $@` = "." ] || mv buildinfo-positionDB.[ch] `dirname $@`

